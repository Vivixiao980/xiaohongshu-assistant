# 🌩️ 百度云语音识别配置指南

## 🚀 为什么使用云端API？

### 性能对比
- **本地Whisper**: 4分钟视频需要5-8分钟处理
- **百度云API**: 4分钟视频只需10-30秒！⚡
- **速度提升**: 10-20倍！

### 成本分析
- **免费额度**: 每月5万次调用
- **超出后**: ¥0.015/次 (约1.5分钱)
- **4分钟视频**: 约¥0.015成本

## 📋 配置步骤

### 1️⃣ 获取百度云API密钥

1. **访问**: https://cloud.baidu.com/
2. **注册/登录**百度云账号
3. **进入控制台** → **人工智能** → **语音技术**
4. **创建应用**:
   ```
   应用名称: 小红书助手
   应用类型: Web应用  
   接口选择: ✅ 短语音识别
   ```
5. **获取密钥**:
   ```
   API Key: 24位字符串
   Secret Key: 32位字符串
   ```

### 2️⃣ 在Railway配置环境变量

1. 打开 https://railway.app
2. 进入项目 `xiaohongshu-assistant`
3. 点击 **Variables** 标签
4. 添加环境变量:

```bash
变量名: BAIDU_API_KEY
变量值: 你的API_Key

变量名: BAIDU_SECRET_KEY  
变量值: 你的Secret_Key

变量名: USE_CLOUD_API
变量值: true
```

### 3️⃣ 重新部署

设置完环境变量后，Railway会自动重新部署。

## ⚡ 使用效果

### 处理流程对比

**原本流程** (5-8分钟):
```
下载视频 → 加载Whisper模型 → 处理27483帧 → 转换文字
```

**云端API流程** (10-30秒):
```
下载音频 → 上传到百度云 → 获取识别结果 → 返回文字
```

### 日志输出示例

```bash
收到视频转文字请求: https://...
使用云端API处理视频
开始下载视频...
视频下载完成: 《非暴力沟通》 (274秒)
使用百度云语音识别...
百度云识别完成
云端视频处理完成
视频转文字完成，字数: 1603
```

## 🔧 故障排除

### 常见问题

1. **API密钥错误**:
   ```
   错误: 百度API配置错误
   解决: 检查BAIDU_API_KEY和BAIDU_SECRET_KEY是否正确
   ```

2. **网络超时**:
   ```
   错误: 语音识别失败: timeout
   解决: 会自动回退到本地Whisper处理
   ```

3. **音频格式不支持**:
   ```
   错误: 百度API错误: audio format not supported
   解决: 系统会自动转换为支持的格式
   ```

### 调试模式

设置环境变量 `DEBUG=true` 可以看到更详细的日志。

## 📊 监控使用量

1. 访问百度云控制台
2. **语音技术** → **用量统计**
3. 查看每日调用次数和费用

## 🎯 最佳实践

1. **测试阶段**: 使用免费额度
2. **生产环境**: 监控用量，设置预算提醒
3. **备用方案**: 保留本地Whisper作为备用
4. **成本控制**: 超出免费额度时可临时关闭云端API

## 🔄 切换回本地处理

如需切换回本地Whisper处理：
1. 在Railway Variables中删除 `USE_CLOUD_API` 变量
2. 或将其值设为 `false`
3. 系统会自动重新部署并使用本地处理
