<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç³»ç»Ÿè°ƒè¯•é¡µé¢</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-8 text-center">ç³»ç»Ÿè°ƒè¯•é¡µé¢</h1>
        
        <!-- åŸºç¡€æµ‹è¯• -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-bold mb-4">ğŸ”§ åŸºç¡€åŠŸèƒ½æµ‹è¯•</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <button id="test-jquery" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded">
                    æµ‹è¯•jQuery
                </button>
                <button id="test-fetch" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded">
                    æµ‹è¯•Fetch API
                </button>
                <button id="test-health" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-4 rounded">
                    æµ‹è¯•å¥åº·æ£€æŸ¥
                </button>
                <button id="test-login-redirect" class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-2 px-4 rounded">
                    æµ‹è¯•ç™»å½•è·³è½¬
                </button>
            </div>
        </div>

        <!-- APIæµ‹è¯• -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-bold mb-4">ğŸ”Œ APIè¿æ¥æµ‹è¯•</h2>
            
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">æµ‹è¯•Token (å¯é€‰):</label>
                <input type="text" id="test-token" class="w-full p-2 border border-gray-300 rounded" placeholder="è¾“å…¥JWT tokenè¿›è¡Œè®¤è¯æµ‹è¯•">
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <button id="test-auth-me" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded">
                    æµ‹è¯•ç”¨æˆ·ä¿¡æ¯API
                </button>
                <button id="test-analyze" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded">
                    æµ‹è¯•åˆ†æAPI
                </button>
                <button id="test-generate" class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded">
                    æµ‹è¯•ç”ŸæˆAPI
                </button>
            </div>
        </div>

        <!-- ç™»å½•æµ‹è¯• -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-bold mb-4">ğŸ” ç™»å½•åŠŸèƒ½æµ‹è¯•</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ç”¨æˆ·å:</label>
                    <input type="text" id="debug-username" value="admin" class="w-full p-2 border border-gray-300 rounded">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">å¯†ç :</label>
                    <input type="password" id="debug-password" value="admin123456" class="w-full p-2 border border-gray-300 rounded">
                </div>
            </div>
            
            <button id="test-login" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                æµ‹è¯•ç™»å½•
            </button>
        </div>

        <!-- æ—¥å¿—æ˜¾ç¤º -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-xl font-bold mb-4">ğŸ“‹ æµ‹è¯•æ—¥å¿—</h2>
            <div id="debug-log" class="bg-gray-100 p-4 rounded max-h-96 overflow-y-auto font-mono text-sm">
                <div class="text-gray-500">ç­‰å¾…æµ‹è¯•ç»“æœ...</div>
            </div>
            <button id="clear-log" class="mt-4 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded">
                æ¸…ç©ºæ—¥å¿—
            </button>
        </div>
    </div>

    <script>
        // æ—¥å¿—å‡½æ•°
        function log(message, type = 'info') {
            const logDiv = document.getElementById('debug-log');
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                info: 'text-blue-600',
                success: 'text-green-600',
                error: 'text-red-600',
                warning: 'text-yellow-600'
            };
            
            const logEntry = document.createElement('div');
            logEntry.className = `mb-1 ${colors[type]}`;
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            
            if (logDiv.children.length === 1 && logDiv.children[0].classList.contains('text-gray-500')) {
                logDiv.innerHTML = '';
            }
            
            logDiv.appendChild(logEntry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        $(document).ready(function() {
            log('è°ƒè¯•é¡µé¢åŠ è½½å®Œæˆ', 'success');

            // åŸºç¡€æµ‹è¯•
            $('#test-jquery').click(function() {
                log('jQueryå·¥ä½œæ­£å¸¸!', 'success');
            });

            $('#test-fetch').click(async function() {
                try {
                    const response = await fetch('/health');
                    const data = await response.json();
                    log(`Fetch APIå·¥ä½œæ­£å¸¸: ${JSON.stringify(data)}`, 'success');
                } catch (error) {
                    log(`Fetch APIé”™è¯¯: ${error.message}`, 'error');
                }
            });

            $('#test-health').click(async function() {
                try {
                    const response = await fetch('/health');
                    const data = await response.json();
                    log(`å¥åº·æ£€æŸ¥æˆåŠŸ: ${JSON.stringify(data)}`, 'success');
                } catch (error) {
                    log(`å¥åº·æ£€æŸ¥å¤±è´¥: ${error.message}`, 'error');
                }
            });

            $('#test-login-redirect').click(function() {
                log('å°è¯•è·³è½¬åˆ°ç™»å½•é¡µé¢...', 'info');
                window.location.href = '/auth.html';
            });

            // APIæµ‹è¯•
            $('#test-auth-me').click(async function() {
                const token = $('#test-token').val() || localStorage.getItem('token');
                if (!token) {
                    log('æ²¡æœ‰tokenï¼Œæ— æ³•æµ‹è¯•ç”¨æˆ·ä¿¡æ¯API', 'warning');
                    return;
                }

                try {
                    const response = await fetch('/auth/me', {
                        headers: { 'Authorization': `Bearer ${token}` }
                    });
                    const data = await response.json();
                    log(`ç”¨æˆ·ä¿¡æ¯APIå“åº”: ${JSON.stringify(data, null, 2)}`, response.ok ? 'success' : 'error');
                } catch (error) {
                    log(`ç”¨æˆ·ä¿¡æ¯APIé”™è¯¯: ${error.message}`, 'error');
                }
            });

            $('#test-analyze').click(async function() {
                const token = $('#test-token').val() || localStorage.getItem('token');
                if (!token) {
                    log('æ²¡æœ‰tokenï¼Œæ— æ³•æµ‹è¯•åˆ†æAPI', 'warning');
                    return;
                }

                try {
                    const response = await fetch('/api/analyze', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}`
                        },
                        body: JSON.stringify({
                            content: 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•å°çº¢ä¹¦ç¬”è®°å†…å®¹ï¼Œç”¨äºæµ‹è¯•APIæ˜¯å¦æ­£å¸¸å·¥ä½œã€‚',
                            model: 'claude',
                            showThinking: true,
                            useDeepAnalysis: true
                        })
                    });
                    const data = await response.json();
                    log(`åˆ†æAPIå“åº”: ${JSON.stringify(data, null, 2)}`, response.ok ? 'success' : 'error');
                } catch (error) {
                    log(`åˆ†æAPIé”™è¯¯: ${error.message}`, 'error');
                }
            });

            $('#test-generate').click(async function() {
                const token = $('#test-token').val() || localStorage.getItem('token');
                if (!token) {
                    log('æ²¡æœ‰tokenï¼Œæ— æ³•æµ‹è¯•ç”ŸæˆAPI', 'warning');
                    return;
                }

                try {
                    const response = await fetch('/api/generate', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}`
                        },
                        body: JSON.stringify({
                            originalContent: 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•å°çº¢ä¹¦ç¬”è®°å†…å®¹',
                            newTopic: 'æµ‹è¯•ä¸»é¢˜',
                            keywords: 'æµ‹è¯•,å…³é”®è¯',
                            model: 'claude',
                            showThinking: true,
                            useDeepAnalysis: true
                        })
                    });
                    const data = await response.json();
                    log(`ç”ŸæˆAPIå“åº”: ${JSON.stringify(data, null, 2)}`, response.ok ? 'success' : 'error');
                } catch (error) {
                    log(`ç”ŸæˆAPIé”™è¯¯: ${error.message}`, 'error');
                }
            });

            // ç™»å½•æµ‹è¯•
            $('#test-login').click(async function() {
                const username = $('#debug-username').val();
                const password = $('#debug-password').val();

                if (!username || !password) {
                    log('è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ', 'warning');
                    return;
                }

                try {
                    log(`å°è¯•ç™»å½•: ${username}`, 'info');
                    const response = await fetch('/auth/login', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            identifier: username, 
                            password: password 
                        })
                    });
                    const data = await response.json();
                    
                    if (data.success) {
                        localStorage.setItem('token', data.token);
                        $('#test-token').val(data.token);
                        log(`ç™»å½•æˆåŠŸ! Token: ${data.token.substring(0, 20)}...`, 'success');
                    } else {
                        log(`ç™»å½•å¤±è´¥: ${data.message}`, 'error');
                    }
                } catch (error) {
                    log(`ç™»å½•è¯·æ±‚é”™è¯¯: ${error.message}`, 'error');
                }
            });

            // æ¸…ç©ºæ—¥å¿—
            $('#clear-log').click(function() {
                $('#debug-log').html('<div class="text-gray-500">ç­‰å¾…æµ‹è¯•ç»“æœ...</div>');
            });

            // æ£€æŸ¥æ˜¯å¦æœ‰å­˜å‚¨çš„token
            const existingToken = localStorage.getItem('token');
            if (existingToken) {
                $('#test-token').val(existingToken);
                log(`å‘ç°å·²å­˜å‚¨çš„token: ${existingToken.substring(0, 20)}...`, 'info');
            }
        });
    </script>
</body>
</html> 